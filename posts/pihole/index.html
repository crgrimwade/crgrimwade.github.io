<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Pi Hole" /><meta property="og:locale" content="en" /><meta name="description" content="Pi-Hole provides a combinations of ad-blocking and protection from malicious sites. It does this by intercepting all name lookups and comparing them to a defined list of sites and if the lookup matches one on its blacklist it blocks the lookup. For any “local” lookups (i.e. without a full domain name e.g. myhost or with a local domain name e.g. myhost.localdomain) it will forward the request to a local DNS server - usually the router. For any non local FQDNs e.g. google.co.uk it will forward to the outside world - in this installation that uses unbound which goes direct to the root DNS servers rather than to your internet provider or google, this helps prevent those organisations controlling what you can see and using your lookups for their marketting goals." /><meta property="og:description" content="Pi-Hole provides a combinations of ad-blocking and protection from malicious sites. It does this by intercepting all name lookups and comparing them to a defined list of sites and if the lookup matches one on its blacklist it blocks the lookup. For any “local” lookups (i.e. without a full domain name e.g. myhost or with a local domain name e.g. myhost.localdomain) it will forward the request to a local DNS server - usually the router. For any non local FQDNs e.g. google.co.uk it will forward to the outside world - in this installation that uses unbound which goes direct to the root DNS servers rather than to your internet provider or google, this helps prevent those organisations controlling what you can see and using your lookups for their marketting goals." /><link rel="canonical" href="https://crgrimwade.github.io/posts/pihole/" /><meta property="og:url" content="https://crgrimwade.github.io/posts/pihole/" /><meta property="og:site_name" content="C R Grimwade" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-05T13:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pi Hole" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-05T13:00:00+01:00","datePublished":"2022-06-05T13:00:00+01:00","description":"Pi-Hole provides a combinations of ad-blocking and protection from malicious sites. It does this by intercepting all name lookups and comparing them to a defined list of sites and if the lookup matches one on its blacklist it blocks the lookup. For any “local” lookups (i.e. without a full domain name e.g. myhost or with a local domain name e.g. myhost.localdomain) it will forward the request to a local DNS server - usually the router. For any non local FQDNs e.g. google.co.uk it will forward to the outside world - in this installation that uses unbound which goes direct to the root DNS servers rather than to your internet provider or google, this helps prevent those organisations controlling what you can see and using your lookups for their marketting goals.","headline":"Pi Hole","mainEntityOfPage":{"@type":"WebPage","@id":"https://crgrimwade.github.io/posts/pihole/"},"url":"https://crgrimwade.github.io/posts/pihole/"}</script><title>Pi Hole | C R Grimwade</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="C R Grimwade"><meta name="application-name" content="C R Grimwade"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/colin.gif " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">C R Grimwade</a></div><div class="site-subtitle font-italic">My Installation Notes</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/crgrimwade" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Pi Hole</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Pi Hole</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">C R Grimwade</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1654430400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1578 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>Pi-Hole provides a combinations of ad-blocking and protection from malicious sites. It does this by intercepting all name lookups and comparing them to a defined list of sites and if the lookup matches one on its blacklist it blocks the lookup. For any “local” lookups (i.e. without a full domain name e.g. <code class="language-plaintext highlighter-rouge">myhost</code> or with a local domain name e.g. <code class="language-plaintext highlighter-rouge">myhost.localdomain</code>) it will forward the request to a local DNS server - usually the router. For any non local FQDNs e.g. <code class="language-plaintext highlighter-rouge">google.co.uk</code> it will forward to the outside world - in this installation that uses <code class="language-plaintext highlighter-rouge">unbound</code> which goes direct to the root DNS servers rather than to your internet provider or google, this helps prevent those organisations controlling what you can see and using your lookups for their marketting goals.</p><h1 id="preparation-step-1---freeing-up-port-53">Preparation Step 1 - Freeing up port 53</h1><p>DNS lookups use specified default ports - in some linux e.g. <code class="language-plaintext highlighter-rouge">ubuntu</code> installations these ports have dummy dns configurations so we need to make sure these are clear before setting up Pi-Hole. In my setup on the NAS this step is not required. First check if the port is in use, then if it is reconfigure the <code class="language-plaintext highlighter-rouge">resolv.conf</code> file in <code class="language-plaintext highlighter-rouge">/etc</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>lsof -nP -iTCP -sTCP:LISTEN     # Check if port 53 is already in use.
cd /etc
rm resol.conf
ln -s ../run/systemd/resolve/resolv.conf /etc/resolv.conf
sed -r -i.orig 's/#?DNSStubListener=yes/DNSStubListener=no/g' /etc/systemd/resolved.conf
systemctl restart systemd-resolved.service
</pre></table></code></div></div><h1 id="preparation-step-2---increasing-the-available-memory">Preparation Step 2 - Increasing the available memory</h1><p>Temporary fix - lost after reboot</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sysctl -w net.core.rmem_max=1048576
sysctl -w net.core.wmem_max=1048576
</pre></table></code></div></div><p>To make it permanent</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>echo "net.core.rmem_max=1048576" &gt;/etc/sysctl.d/local.conf
echo "net.core.wmem_max=1048576" &gt;&gt;/etc/sysctl.d/local.conf
</pre></table></code></div></div><h1 id="installing-pi-hole-and-unbound-in-docker">Installing Pi-Hole and Unbound in Docker</h1><p>Use the docker compose file at the bottom of the post to create a docker stack with two containers <code class="language-plaintext highlighter-rouge">pihole</code> and <code class="language-plaintext highlighter-rouge">unbound</code> make sure to adjust the volumes to map to your intallation and configure the docker network, timezone and passwords etc. When complete start the stack - this will create various configurations within the mounted volumes.</p><h2 id="configuring-unbound"><span class="mr-2">Configuring Unbound</span><a href="#configuring-unbound" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Unbound needs to know how to forward requests from Pi-Hole out to the internet, avoiding those DNS servers that track your activity - such as google. The following actions should be done in the <code class="language-plaintext highlighter-rouge">/opt/unbound/etc/unbound</code> folder of the unbound docker container or in the host folder to which it is mapped e.g. <code class="language-plaintext highlighter-rouge">/volume1/Docker/unbound</code></p><p>First Fetch the <code class="language-plaintext highlighter-rouge">root.hints</code> file - this file will contain IPv6 details which can optionally be commented out - do this for any line with an AAAA type record.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget -O root.hints https://www.internic.net/domain/named.root
</pre></table></code></div></div><p>Next create an <code class="language-plaintext highlighter-rouge">a-records.conf</code> file with the following contents:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre># A Record
#local-data: "somecomputer.local. A 192.168.1.1"

# PTR Record
#local-data-ptr: "192.168.1.1 somecomputer.local."
</pre></table></code></div></div><p>Then finally edit the <code class="language-plaintext highlighter-rouge">unbound.conf</code> file - see <a href="https://docs.pi-hole.net/guides/dns/unbound/">pihole documentation</a> for more details and an example of this file can be found at the end of this post.</p><h2 id="configuring-pi-hole"><span class="mr-2">Configuring Pi-Hole</span><a href="#configuring-pi-hole" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We need to tell Pi-Hole to forward requests within our local IP ranges to our local DNS server (typically our router). Access the Pihole GUI (hostname:82/admin) and in the DNS tab of settings configure the following:</p><ul><li>enable - Never forward non-FQDNs<li>enable - Never forward reverse lookups for private IP ranges<li>disable - Use DNSSEC<li>enable - Use Conditional Forwarding<li>Local networks - set to your network e.g. `192.168.1.0/24<li>Ip address of your DHCP server - typically the address of your router<li>Localdomain - set this to whatever your router/DHCP server uses to qualify local names e.g. localdomain</ul><p>When all the configurationis complete test the Pi-Hole DNS resolution - see below for how to test DNS. If/When all the testing is succesful configure your router to tell its clients to use Pi-Hole for their primary DNS resolution and the router as a secondary DNS server.</p><h3 id="adding-blocklists"><span class="mr-2">Adding Blocklists</span><a href="#adding-blocklists" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Then populate the blocklists for sites that should be avoided - see <a href="https://firebog.net/">FireBog</a> for potential lists. Goto <code class="language-plaintext highlighter-rouge">Addlists</code> in the <code class="language-plaintext highlighter-rouge">Group Management</code> menu to add lists. Copy the URL from FireBig to PiHole to add a list.</p><p>Always update gravity after changing the blocklists - this can be found under the <code class="language-plaintext highlighter-rouge">Tools</code> menu.</p><p>Firebog has lots of different list categories covering malicious sites to simply those that use trackers. In general add any malicious sites then choose what else to add. Note adding advertisment list can speed up page loads for ad heavy web pages and blocks some annoying youtube overlay ads (but not the full clips ones).</p><h1 id="testing-pihole-and-unbound">Testing PiHole and Unbound</h1><h2 id="unbound"><span class="mr-2">Unbound</span><a href="#unbound" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Use <code class="language-plaintext highlighter-rouge">dig</code> to send requests to the unbound container on port 5053 - this tests that unbound is correctly forwarding DNS requests to the root servers. Check the docker logs to look for any issues</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dig www.google.com @unbound-host -p 5053 # Replace unbound-host with the relevant unbound IP address
</pre></table></code></div></div><h2 id="pihole"><span class="mr-2">PiHole</span><a href="#pihole" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Use <code class="language-plaintext highlighter-rouge">dig</code> to test PiHoles DNS resolution</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dig www.google.com @pi-host -p 53 # Replace pi-host with the relevant unbound IP address
</pre></table></code></div></div><p>Then with <code class="language-plaintext highlighter-rouge">nslookup</code> test various scenarios</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>nslookup google.co.uk          # Test with default server
nslookup google.co.uk router   # Test with router as server
nslookup google.co.uk pi-host  # Test using Pi-Hole as servers
# Test local lookups: Compare results, check that Pi-Hole sends requests to router
nslookup plexserver            # Test with default server
nslookup plexserver router     # Test with router as server
nslookup plexserver pi-host    # Test using Pi-Hole as servers
</pre></table></code></div></div><h1 id="known-issues">Known Issues</h1><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>        Known Issue: { DNS resolution is currently unavailable when starting pihole
          Make sure the host system of Pi-Hole is NOT using Pi-Hole for DNS
          Happens if the docker host is using pihole as its only name resolution (check /etc/resolv.conf)
          - recommendation that everyone add --dns 127.0.0.1 --dns 1.1.1.1 to their docker run commands in order to avoid these types of errors
          not managed to get the above to work yet
          - Just add "nameserver 192.168.1.1" to start of /etc/resolv.conf (change IP to that of the router) 
          restart pihole container - Might be able to remove this afterwards, but likely need to re-add to restart pihole
          might be possible to add as second item and leave in - needs further investigation
          - apt install resolvconf
          systemctl start resolvconf.service
          systemctl enable resolvconf.service
          vi /etc/resolvconf/resolv.conf.d/head # add nameserver 8.8.8.8         
</pre></table></code></div></div><h1 id="unboundconf-file">Unbound.conf File</h1><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre># If no logfile is specified, syslog is used
# logfile: "/var/log/unbound/unbound.log"
verbosity: 0

access-control: 172.16.0.0/12 allow
access-control: 127.0.0.0/8 allow
access-control: 10.0.0.0/8 allow
access-control: 192.168.0.0/16 allow
interface: 0.0.0.0
port: 5053                       # Make sure this matches the unbound configuration in docker-compose.yml
do-ip4: yes
do-udp: yes
do-tcp: yes

# May be set to yes if you have IPv6 connectivity
do-ip6: no

# You want to leave this to no unless you have *native* IPv6. With 6to4 and
# Terredo tunnels your web browser should favor IPv4 for the same reasons
prefer-ip6: no

# Use this only when you downloaded the list of primary root servers!
# If you use the default dns-root-data package, unbound will find it automatically
#root-hints: "/var/lib/unbound/root.hints"
root-hints: /opt/unbound/etc/unbound/root.hints

# Trust glue only if it is within the server's authority
harden-glue: yes

# Require DNSSEC data for trust-anchored zones, if such data is absent, the zone becomes BOGUS
harden-dnssec-stripped: yes

# Don't use Capitalization randomization as it known to cause DNSSEC issues sometimes
# see https://discourse.pi-hole.net/t/unbound-stubby-or-dnscrypt-proxy/9378 for further details
use-caps-for-id: no

# Reduce EDNS reassembly buffer size.
# Suggested by the unbound man page to reduce fragmentation reassembly problems
edns-buffer-size: 1472

# Perform prefetching of close to expired message cache entries
# This only applies to domains that have been frequently queried
prefetch: yes

# One thread should be sufficient, can be increased on beefy machines. In reality for most users
# running on small networks or on a single machine, it should be unnecessary to seek performance
# enhancement by increasing num-threads above 1.
num-threads: 1

# Ensure kernel buffer is large enough to not lose messages in traffic spikes
so-rcvbuf: 1m

#unbound_anchorflags: "-4"

# Ensure privacy of local IP ranges
private-address: 192.168.0.0/16
private-address: 169.254.0.0/16
private-address: 172.16.0.0/12
private-address: 10.0.0.0/8
private-address: fd00::/8
private-address: fe80::/10

#plex
private-domain: plex.direct
</pre></table></code></div></div><h1 id="docker-compose-file">Docker Compose File</h1><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span>  <span class="s2">"</span><span class="s">3.0"</span> 
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">dns_net</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">ipam</span><span class="pi">:</span>
      <span class="na">config</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">subnet</span><span class="pi">:</span> <span class="s">172.27.0.0/16</span>     <span class="c1"># Pick a subnet that is not already in use</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">pihole</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">pihole</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">pihole</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">pihole/pihole:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">dns_net</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.27.0.6</span>    <span class="c1"># Pick an address in the above subnet</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">53:53/tcp</span>
      <span class="pi">-</span> <span class="s">53:53/udp</span>
      <span class="pi">-</span> <span class="s">67:67/udp</span>
      <span class="pi">-</span> <span class="s">180:80/tcp</span> <span class="c1"># Choose an available port</span>
      <span class="pi">-</span> <span class="s">1443:443/tcp</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/volume1/Docker/pihole/pihole:/etc/pihole</span>
      <span class="pi">-</span> <span class="s">/volume1/Docker/pihole/dnsmasq:/etc/dnsmasq.d</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">TZ="Europe/London"</span>         <span class="c1"># Select your timezon</span>
      <span class="pi">-</span> <span class="s">WEBPASSWORD=password</span>       <span class="c1"># Dont forget to set a password</span>
      <span class="pi">-</span> <span class="s">DNS1=172.27.0.7#5053</span>       <span class="c1"># Use the address/port configured for unbound below</span>
      <span class="pi">-</span> <span class="s">DNS2=no</span>

  <span class="na">unbound</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">unbound</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mvance/unbound:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">dns_net</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.27.0.7</span>    <span class="c1"># Pick an address in the above subnet</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">5053:5053/tcp</span>               <span class="c1"># Use this port in PiHole above</span>
      <span class="pi">-</span> <span class="s">5053:5053/udp</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/volume1/Docker/unbound:/opt/unbound/etc/unbound</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">disable</span><span class="pi">:</span> <span class="no">true</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ad-blocker/'>Ad Blocker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pi Hole - C R Grimwade&amp;url=https://crgrimwade.github.io/posts/pihole/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pi Hole - C R Grimwade&amp;u=https://crgrimwade.github.io/posts/pihole/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://crgrimwade.github.io/posts/pihole/&amp;text=Pi Hole - C R Grimwade" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kubernetes/">Kubernetes</a><li><a href="/posts/proxmox/">ProxMox</a><li><a href="/posts/jekyll/">Jekyll</a><li><a href="/posts/rasbian/">Rasbian OS</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/guides/">guides</a> <a class="post-tag" href="/tags/pi/">pi</a> <a class="post-tag" href="/tags/test/">test</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pn50/"><div class="card-body"> <em class="timeago small" data-ts="1654435800" > 2022-06-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PN50 - Windows + Ubuntu</h3><div class="text-muted small"><p> This post describes how to install a dual boot Windows and Ubuntu onto a PN50, this starts with the installation of Windows followed by the addition of Ubuntu. The PN50 in question has a 250G prima...</p></div></div></a></div><div class="card"> <a href="/posts/proxmox/"><div class="card-body"> <em class="timeago small" data-ts="1654433400" > 2022-06-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ProxMox</h3><div class="text-muted small"><p> ProxMox is a platform to host virtual machines and containers, in this configuration there are two machines each with an SSD and NVME drives. The hardware being used for both are HP mini format mac...</p></div></div></a></div><div class="card"> <a href="/posts/mdcheatsheet/"><div class="card-body"> <em class="timeago small" data-ts="1654432260" > 2022-06-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cheatsheet</h3><div class="text-muted small"><p> Markdown Cheat Sheet Thanks for visiting The Markdown Guide! This Markdown cheat sheet provides a quick overview of all the Markdown syntax elements. It can’t cover every edge case, so if you nee...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rasbian/" class="btn btn-outline-primary" prompt="Older"><p>Rasbian OS</p></a> <a href="/posts/kubernetes/" class="btn btn-outline-primary" prompt="Newer"><p>Kubernetes</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">C R Grimwade</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/guides/">guides</a> <a class="post-tag" href="/tags/pi/">pi</a> <a class="post-tag" href="/tags/test/">test</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
